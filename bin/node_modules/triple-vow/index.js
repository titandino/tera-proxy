const VOW_LOCKON = 67228964

module.exports = function TripleVow(dispatch) {
	let cid = null,
		job = -1,
		locked = 0,
		lockon2 = null

	dispatch.hook('S_LOGIN', 1, event => {
		({cid} = event)

		job = (event.model - 10101) % 100
	})

	dispatch.hook('S_CAN_LOCKON_TARGET', 1, event => {
		if(job == 7 && event.skill == VOW_LOCKON && event.ok) {
			locked++

			if(locked == 2) {
				lockon2 = event
				return false
			}

			if(locked == 3)
				dispatch.toClient('S_CAN_LOCKON_TARGET', lockon2)
		}
	})

	dispatch.hook('S_ACTION_END', 1, event => {
		if(event.source.equals(cid) && job == 7 && event.skill == VOW_LOCKON) {
			locked = 0
			lockon2 = null
		}
	})
}